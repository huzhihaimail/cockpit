<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
【命名规范说明 】
1. 文件名采用 "表名.xml" 的方式；
2. 每个SQL上需要编写该条SQL的注释；
3. SQL关键字采用全大写的方式；
4. 如果允许，请尽量保持SQL的ID和对应的业务方法名保持一致；
5. 查询SQL如果需要使用自动分页，则其SQL的ID必须使用ByPage结尾；
6. 可以使用MyBatis流程控制语句来实现SQL的重用；
6. 注意SQL排版；
-->

<mapper namespace="cn.com.njdhy.muscle.triceps.dao.SysPrivilegeDao">

    <resultMap id="SysPrivilegeMap" type="SysPrivilege">
        <result property="name" column="name"/>
        <result property="menuId" column="menu_id"/>
        <result property="id" column="id"/>
        <result property="createDate" column="create_date"/>
        <result property="updateDate" column="update_date"/>
        <result property="deleteFlag" column="delete_flag"/>
    </resultMap>

    <!-- 配置表名 -->
    <sql id="tableName">
        sys_privilege
    </sql>

    <!-- for insert columns -->
    <sql id="columns">
        id, name, menu_id, create_date, update_date, delete_flag
    </sql>

    <!-- for insert value -->
    <sql id="values">
        #{id}, #{name}, #{menuId}, now(), now(), 0
    </sql>

    <!-- for update set -->
    <sql id="updates">
        name=#{name}, menu_id=#{menuId}, delete_flag=#{deleteFlag}, update_date=now()
    </sql>

    <!-- 查询加载表格 -->
    <select id="queryList" resultMap="SysPrivilegeMap" parameterType="map">
        SELECT
        t.id,
        t. NAME,
        t.menu_id,
        m.`name` as menuName,
        t.create_date,
        t.update_date,
        t.delete_flag
        FROM
        <include refid="tableName"/>
        t
        LEFT JOIN sys_menu m ON t.menu_id = m.id
        WHERE 1=1
        AND t.delete_flag = 0
        <if test="keyword!=null and keyword!=''">
            AND t.name LIKE CONCAT('%',#{keyword},'%')
        </if>
        <if test="sortName!=null and sorName!='' and sortOrder !=null and sortOrder!=''">
            ORDER BY #{sortName} #{sortOrder}
        </if>
    </select>

    <!-- 根据用户名查询用户权限 -->
    <select id="queryPrivilegesByUserName" resultType="List" parameterType="map">
        SELECT
        t.perms
        FROM
        <include refid="tableName"/>
        t
        LEFT JOIN sys_role_privilege rp ON rp.privilege_id = t.id
        LEFT JOIN sys_role r ON rp.role_id = r.id
        LEFT JOIN sys_user_role ur ON ur.role_id = r.id
        LEFT JOIN sys_user u ON ur.user_id = u.id
        WHERE 1 = 1
        AND u.user_name =#{userName}
    </select>

    <!-- 根据ID查询-->
    <select id="queryById" resultMap="SysPrivilegeMap" parameterType="String">
        SELECT
        id, name, menu_id, create_date, update_date, delete_flag
        FROM
        <include refid="tableName"/>
        WHERE 1 = 1
        AND id=#{id}
    </select>

    <!-- 批量删除-->
    <delete id="deleteByIds" parameterType="java.util.List">
        DELETE FROM
        <include refid="tableName"/>
        WHERE 1=1
        AND id IN
        <foreach item="id" index="index" collection="list" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <!-- 新建  -->
    <insert id="insert" parameterType="SysPrivilege" keyProperty="id">
        INSERT INTO
        <include refid="tableName"/>
        (<include refid="columns"/>)
        VALUES
        (<include refid="values"/>)
    </insert>

    <!-- 修改 -->
    <update id="update" parameterType="SysPrivilege">
        UPDATE
        <include refid="tableName"/>
        SET
        <include refid="updates"/>
        WHERE id = #{id}
    </update>


</mapper>

